<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Bootstrap demo</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">
  </head>
  <body>
    <nav class="navbar bg-light">
        <div class="container-fluid">
          <a class="navbar-brand" href="#" style="display: flex;flex-direction: row;flex-wrap: nowrap;align-items: center;justify-content: center; font-size: 30px; color: rgb(158, 114, 4); font-weight: 500;">
            <span class="material-symbols-outlined" style="margin-right: 10px;">local_atm</span>
            Cards Premiados
          </a>
          <a class="navbar-brand" href="#" style="display: flex;flex-direction: row;flex-wrap: nowrap;align-items: center;justify-content: center; font-size: 15px; color: rgb(158, 114, 4); font-weight: 500;">
            <span class="material-symbols-outlined" style="margin-right: 5px;">account_circle</span>
            Giba
          </a>
        </div>
    </nav>

        <div style="display: flex;
        flex-direction: row;
        flex-wrap: nowrap;
        align-items: center;
        justify-content: center;
        margin: 20px;">
            <span style="font-size: 20px; font-weight: 800; font-family: inherit; color: rgb(214, 160, 22)">HOJE PODE SER O SEU DIA DE SORTE!</span>
        </div>

      <div style="
      margin: 30px;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      height: 100%;
      width: 100;
      align-content: center">
        <div class="card" onclick="openDialog()" style="width: 18rem; margin: 10px; cursor: pointer;">
            <img src="raspadinha.jpg" class="card-img-top" alt="raspadinha.jpg">
            <div class="card-body">
              <p class="card-text">R$ 10,90</p>
            </div>
        </div>
        <div class="card" onclick="openDialog()" style="width: 18rem; margin: 10px; cursor: pointer;">
            <img src="raspadinha.jpg" class="card-img-top" alt="raspadinha.jpg">
            <div class="card-body">
              <p class="card-text">R$ 10,90</p>
            </div>
        </div>
        <div class="card" onclick="openDialog()" style="width: 18rem; margin: 10px; cursor: pointer;">
            <img src="raspadinha.jpg" class="card-img-top" alt="raspadinha.jpg">
            <div class="card-body">
              <p class="card-text">R$ 10,90</p>
            </div>
        </div>
        <div class="card" onclick="openDialog()" style="width: 18rem; margin: 10px; cursor: pointer;">
            <img src="raspadinha.jpg" class="card-img-top" alt="raspadinha.jpg">
            <div class="card-body">
              <p class="card-text">R$ 10,90</p>
            </div>
        </div>
        <div class="card" onclick="openDialog()" style="width: 18rem; margin: 10px; cursor: pointer;">
            <img src="raspadinha.jpg" class="card-img-top" alt="raspadinha.jpg">
            <div class="card-body">
              <p class="card-text">R$ 10,90</p>
            </div>
        </div>
        <div class="card" onclick="openDialog()" style="width: 18rem; margin: 10px; cursor: pointer;">
            <img src="raspadinha.jpg" class="card-img-top" alt="raspadinha.jpg">
            <div class="card-body">
              <p class="card-text">R$ 10,90</p>
            </div>
        </div>
        <div class="card" onclick="openDialog()" style="width: 18rem; margin: 10px; cursor: pointer;">
            <img src="raspadinha.jpg" class="card-img-top" alt="raspadinha.jpg">
            <div class="card-body">
              <p class="card-text">R$ 10,90</p>
            </div>
        </div>
        <div class="card" onclick="openDialog()" style="width: 18rem; margin: 10px; cursor: pointer;">
            <img src="raspadinha.jpg" class="card-img-top" alt="raspadinha.jpg">
            <div class="card-body">
              <p class="card-text">R$ 10,90</p>
            </div>
        </div>
        <div class="card" onclick="openDialog()" style="width: 18rem; margin: 10px; cursor: pointer;">
            <img src="raspadinha.jpg" class="card-img-top" alt="raspadinha.jpg">
            <div class="card-body">
              <p class="card-text">R$ 10,90</p>
            </div>
        </div>
        <div class="card" onclick="openDialog()" style="width: 18rem; margin: 10px; cursor: pointer;">
            <img src="raspadinha.jpg" class="card-img-top" alt="raspadinha.jpg">
            <div class="card-body">
              <p class="card-text">R$ 10,90</p>
            </div>
        </div>
        <div class="card" onclick="openDialog()" style="width: 18rem; margin: 10px; cursor: pointer;">
            <img src="raspadinha.jpg" class="card-img-top" alt="raspadinha.jpg">
            <div class="card-body">
              <p class="card-text">R$ 10,90</p>
            </div>
        </div>
        <div class="card" onclick="openDialog()" style="width: 18rem; margin: 10px; cursor: pointer;">
            <img src="raspadinha.jpg" class="card-img-top" alt="raspadinha.jpg">
            <div class="card-body">
              <p class="card-text">R$ 10,90</p>
            </div>
        </div>
        <div class="card" onclick="openDialog()" style="width: 18rem; margin: 10px; cursor: pointer;">
            <img src="raspadinha.jpg" class="card-img-top" alt="raspadinha.jpg">
            <div class="card-body">
              <p class="card-text">R$ 10,90</p>
            </div>
        </div>
        <div class="card" onclick="openDialog()" style="width: 18rem; margin: 10px; cursor: pointer;">
            <img src="raspadinha.jpg" class="card-img-top" alt="raspadinha.jpg">
            <div class="card-body">
              <p class="card-text">R$ 10,90</p>
            </div>
        </div>
        <div class="card" onclick="openDialog()" style="width: 18rem; margin: 10px; cursor: pointer;">
            <img src="raspadinha.jpg" class="card-img-top" alt="raspadinha.jpg">
            <div class="card-body">
              <p class="card-text">R$ 10,90</p>
            </div>
        </div>
      </div>

      <dialog open id="favDialog">
        <span style="font-size: 20px; margin-bottom: 20px; color: rgb(119, 88, 8); font-weight: 500;">Raspadinha de R$ 10,90</span>
        <form method="dialog" style="    display: flex;
        flex-direction: column;">
            <div class="input-group mb-3">
                <span class="input-group-text" id="basic-addon1">Nome</span>
                <input type="text" id="userName" class="form-control" placeholder="Giba" aria-label="Username" aria-describedby="basic-addon1">
            </div>
            <div class="input-group mb-3">
                <span class="input-group-text" id="basic-addon1">Email</span>
                <input type="text" id="email" class="form-control" placeholder="exemplo@gmail.com" aria-label="Username" aria-describedby="basic-addon1">
            </div>
            <div class="input-group mb-3">
                <span class="input-group-text" id="basic-addon1">Documento</span>
                <input type="text" id="userDocument" class="form-control" placeholder="000.000.000-00" aria-label="Username" aria-describedby="basic-addon1">
            </div>
            
            <button id="generatePix" class="btn btn-secondary btn-lg" style="background-color: rgb(160, 118, 13);">Gerar PIX</button>
            <button id="closeFavDialog" class="btn btn-secondary btn-lg" style="background-color: rgb(160, 118, 13); margin: 10px;">Close</button>
          
          <!-- <menu>
            <button id="cancel" type="reset">Cancel</button>
            <button type="submit">Confirm</button>
          </menu> -->
        </form>
      </dialog>

      <dialog open id="pixQRDialog">
        <span style="font-size: 20px; margin-bottom: 20px; color: rgb(119, 88, 8); font-weight: 500;">Raspadinha de R$ 10,90</span>
        <form method="dialog" style="    display: flex;
        flex-direction: column;">
            <div class="card text-bg-dark" style="margin: 10px;">
                <img id="qrCodeImage" src="..." class="card-img" alt="...">
            </div>         
            <button id="close" class="btn btn-secondary btn-lg" style="background-color: rgb(160, 118, 13); margin: 10px;">Close</button>
            <button id="redirectCheckout" class="btn btn-secondary btn-lg" style="background-color: rgb(160, 118, 13); margin: 10px;">Checkout <span class="material-symbols-outlined">google_plus_reshare</span></button>
        </form>
      </dialog>

    <script>
        var favDialog = document.getElementById('favDialog');
        var pixQRDialog = document.getElementById('pixQRDialog');

        (function() {
            var updateButton = document.getElementsByClassName('updateDetails')[0];
            
            var redirectCheckout = document.getElementById('redirectCheckout');
            var qrCodeImage = document.getElementById('qrCodeImage');
            var close = document.getElementById('close');
            var closeFavDialog = document.getElementById('closeFavDialog');
            
            pixQRDialog.close();
            favDialog.close();

            var generatePixButton = document.getElementById('generatePix');
            var userName = document.getElementById('userName');
            var userDocument = document.getElementById('userDocument');
            var request = new XMLHttpRequest();
            var response = null;

            redirectCheckout.addEventListener('click', function() {
                pixQRDialog.close();
                pixQRDialog.style.visibility = 'hidden';
                var win = window.open(response.data.checkout, '_blank');
                win.focus();
            });

            close.addEventListener('click', function() {
                pixQRDialog.close();
                pixQRDialog.style.visibility = 'hidden';
            });

            closeFavDialog.addEventListener('click', function() {
                favDialog.close();
                favDialog.style.visibility = 'hidden'
            });

            generatePixButton.addEventListener('click', function(modal) {
                var bodyRequest = JSON.stringify({
                    value: 1,
                    callback: "https://cards-premiados",
                    tenant_id: "2a530c04-4640-4668-ba43-65dfacbe4781",
                    name: userName.value,
                    document: userDocument.value
                });

                request.open("POST", "https://dev-api.pagstar.com/api/v2/wallet/partner/transactions/generate-anonymous-pix");
                request.setRequestHeader('Content-Type', 'application/json');

                request.addEventListener("load", function() {
                    var erroAjax = document.querySelector("#erro-ajax");

                    if (request.status == 200) {
                        pixQRDialog.style.visibility = 'visible';
                        pixQRDialog.showModal();
                        response = JSON.parse(request.responseText);
                        qrCodeImage.src = response.data.qr_code_url.replace('https://images.weserv.nl/?url=', '');
                    } else {
                        favDialog.close();
                        favDialog.style.visibility = 'hidden'
                        alert('Erro ao gerar PIX!');
                    }
                });

                console.log(bodyRequest);

                favDialog.style.visibility = 'hidden'
                favDialog.close();

                request.send(bodyRequest);

                //console.log(bodyRequest);
            });


        })();
        function openDialog () {
            favDialog.style.visibility = 'visible'
            favDialog.showModal();
        }
    </script>
    <style>
        dialog {
            width: 800px;
            height: 500px;
            border: none;
            border-radius: 10px;
            box-shadow: 1px 1px 20px 4px #0000007d;
            visibility: hidden;
            display: flex;
            flex-direction: column;
            flex-wrap: nowrap;
            align-items: center;
            justify-content: center;
            visibility: hidden;
            transition: transform 200ms;
        }
        dialog.dialog-scale {
            visibility: visible;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-A3rJD856KowSb7dwlZdYEkO39Gagi7vIsF0jrRAoQmDKKtQBHUuLZ9AsSv4jD4Xa" crossorigin="anonymous"></script>
  </body>
</html>
